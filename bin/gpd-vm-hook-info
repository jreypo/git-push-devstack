#!/usr/bin/env bash

my_dir="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"

# approach borrowed from git-stash
dashless=$(basename "$0" | sed -e 's/-/ /')
USAGE="
NAME
    gpd vm-hook-info - print info about hook including extra vars

USAGE
    $dashless --project <project>
               [--help]
"

usage() {
    local extra=${1:-""}
    if [[ -n "$extra" ]]; then
        printf "$extra\n"
    fi
    printf "$USAGE\n"
    exit 1
}

while (( $# > 0 )); do
key="$1"
shift

case $key in
    -p|--project)
    project=$1
    shift
    ;;
    -h|--help)
    usage
    ;;
    *)
    usage "ERROR: Unknown option: $key"
    ;;
esac
done

source "$my_dir/../lib/vm.bash"
[[ -z $project ]] && usage "ERROR: --project is required"

log_info "project=$project"

"$my_dir/../post-receive/$project.bash" --show-vars